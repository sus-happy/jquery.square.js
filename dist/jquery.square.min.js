!function(e){var t=function(t,s){var i=this;i.set={target:"square",inner:".inner",scaleSplit:"_",size:150,space:10,speed:700,duration:500,ease:""},s&&e.extend(i.set,s),i.disabled=!1,i.parentObj=t.css({position:"relative"}),i.target=i.parentObj.find("*[class^="+i.set.target+"]").css({position:"absolute"}),i.resizeInter=null,i.prevWidth=i.parentObj.outerWidth(),i.size=0,i.space=0,i.isFloated=isNaN(i.set.size)&&i.set.size.match(/\%$/)||isNaN(i.set.space)&&i.set.space.match(/\%$/),i.setSize(),i.setPosition(0),e(window).on("resize.square",function(){i.resizeStart()})};t.prototype.resizeStart=function(){var t=this;t.disabled||(e(window).off("resize.square"),t.resizeInter=setInterval(function(){t.resizeCheck()},t.set.duration))},t.prototype.resizeCheck=function(){var t=this;t.disabled||(t.prevWidth=t.parentObj.outerWidth(),t.prevWidth==t.parentObj.outerWidth()&&(clearInterval(t.resizeInter),e(window).on("resize.square",function(){t.resizeStart()}),t.resizeEnd()))},t.prototype.resizeEnd=function(){var e=this;e.disabled||(e.isFloated&&e.setSize(),e.setPosition(e.set.speed))},t.prototype.setSize=function(){var t=this;t.calcSize(),t.target.each(function(s){var i=t.getScale(e(this).attr("class")),r=t.size*i.x+t.space*(i.x-1),a=t.size*i.y+t.space*(i.y-1);if(e(this).css({width:r,height:a}),e(this).find(t.set.inner).length>0){var n=e(this).find(t.set.inner);if(n.height(a),n.outerHeight()>a){var o=n.height()-(n.outerHeight()-a);n.height(o)}}})},t.prototype.setPosition=function(t){var s=this,i=[],r={},a=0;s.target.each(function(n){r=s.blankMatrix(i);var o=s.getScale(e(this).attr("class")),c=(s.size,o.x,s.space,o.x,s.size*o.y+s.space*(o.y-1));for(s.checkSize(r.x,o)&&(r.x=0,r.y++);s.matrixCheck(i,r.x,r.y,o);)r.x++,s.checkSize(r.x,o)&&(r.x=0,r.y++);for(var p=0;p<o.x;p++)for(var h=0;h<o.y;h++)i[r.x+p]||(i[r.x+p]=[]),i[r.x+p][r.y+h]=!0;var f={x:s.space+s.size*r.x+s.space*r.x,y:s.space+s.size*r.y+s.space*r.y};t>0?s.goTween(e(this),{left:f.x,top:f.y},t):e(this).css({left:f.x,top:f.y}),a=f.y+c+s.space>a?f.y+c+s.space:a}),t>0?s.goTween(s.parentObj,{height:a},t):s.parentObj.css({height:a})},t.prototype.getScale=function(e){var t=this,s=e.split(" ");for(i in s)if(s[i].match(t.set.scaleSplit)){var r=s[i].split(t.set.scaleSplit)[1],a=s[i].split(t.set.scaleSplit)[2];if(r)return a?{x:r,y:a}:{x:r,y:r}}return{x:1,y:1}},t.prototype.matrixCheck=function(e,t,s,i){if(!e)return!1;for(var r=0;r<i.x;r++)for(var a=0;a<i.y;a++)if(e[t+r]&&e[t+r][s+a])return e[t+r][s+a];return!1},t.prototype.blankMatrix=function(e){for(var t=this,s={x:0,y:0};t.matrixCheck(e,s.x,s.y,1);)s.x++,t.checkSize(s.x,1)&&(s.x=0,s.y++);return s},t.prototype.checkSize=function(e,t){var s=this,i=s.size*t.x+s.space*(t.x-1);return s.size*e+s.space*(e+2)+i>s.parentObj.outerWidth()},t.prototype.goTween=function(t,s,i){var r=this;r.set.ease&&e.easing[r.set.ease]?t.stop(!0,!1).animate(s,i,r.set.ease):t.stop(!0,!1).animate(s,i)},t.prototype.calcSize=function(){var e=this;if(isNaN(e.set.space)){if(e.set.space.match(/\%$/)){t=e.set.space.replace("%","")-0;e.space=e.parentObj.width()*(t/100)}}else e.space=e.set.space;if(isNaN(e.set.size)){if(e.set.size.match(/\%$/)){var t=e.set.size.replace("%","")-0,s=Math.ceil(100/t);e.size=(e.parentObj.width()-e.space*(s+1))*(t/100)}}else e.size=e.set.size},t.prototype.destroy=function(){var t=this;t.disabled=!0,t.resizeInter&&clearInterval(t.resizeInter),e(window).off(".square"),t.parentObj.attr("style",""),t.target.attr("style","")},e.fn.square=function(s){return new t(e(this),s)}}(jQuery);